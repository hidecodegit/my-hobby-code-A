# 3. 構成管理 (Configuration Management)

本ドキュメントは、PiPulseパイプラインの構成管理、設計ポリシー、およびリスク管理について定義します。

**最終更新:** 2025-10-24

---

- **改訂履歴**
| 日付 | 変更者 | 変更内容 | 関連 |
|---|---|---|---|
| 2025-10-24 | Hideo (assisted by Gemini) | レビューに基づく微調整（一貫性/視覚強化）。 | PR #18<br>(v1.2.4参照) |
| 2025-10-23 | Hideo (assisted by Gemini) | タイムゾーン方針と潜在リスクにインシデント事例への参照リンクを追加。 | PR #13 |
| 2025-10-22 | Hideo (assisted by Gemini) | 初版作成。 | PR #11 |

---

### クイックリード
1.  タイムゾーン: JST統一。
2.  リスク: I2C/同期対策。
3.  V字リンク: SYS.2/SWE.3強化。

- **V字プロセスリンク**:
  - `SYS.2`: 本ドキュメント群はシステム設計 (docs/system-design.md) のスペック定義に相当。
  - `SWE.3`: `20251022_SensorCopier.py` の実装は (docs/software-specs.md) の依存関係に従う。
  - `SUP.7`: コミットメッセージルール (feat/fix/refactor) を適用。
- **タイムゾーン方針**:
  - **全てのタイムスタンプはJST（日本標準時）で記録・処理する。** これは、個人の趣味プロジェクトとしてのシンプルさと直感的な分かりやすさを最優先するための方針である。
  - Raspberry Piのシステム時刻がJSTに設定されていることを前提とする。
  - **将来的な注意点**: もし将来、海外のクラウドサービスと連携したり、システムを複数地域に展開したりする場合は、タイムゾーンの扱いをUTCに統一する再設計が必要になる可能性がある。
  - **移行注意**: UTCで記録されたJSONデータとの互換性問題が発生したため、タイムゾーン移行時は既存データとの整合性チェックが必須です（詳細: SYS.2 system-design.mdの事例セクション）。このJST統一方針は、[REQ-02]の処理時間<1min目標の達成に貢献します。
- **潜在リスクと対策**:
  - [x] **I2C/センサーエラー**: `20251022_SensorCopier.py` 内でエラーカウンタを設け、3回連続でエラーが発生した場合にセンサーを再初期化。処理終了時にI2Cバスを明示的にクローズする。
  - [x] **メモリ不足 (RPi)**: データの一時保存にRAMディスク (`/tmp/sensor_data`) を使用し、SDカードへの書き込みを抑制。
  - [x] **データ同期エラー**: `rclone` 実行時にリトライ処理（指数バックオフ）を実装済み。**Tips:** 指数バックオフ (retry with increasing delay)。
  - [x] **データ損失**: `rclone sync` の誤用による過去データ削除インシデントを経験。現在は `rclone copy` を採用し、データ損失を防止しています（詳細: SWE.3 implementation.mdのインシデントセクション）。
  - [ ] **運用ログ**: 全体同期の実行理由（初回、時間経過、ファイル破損など）をログに出力し、運用の透明性を確保。
  - [x] **状態更新エラー**: JSONファイル書き込み時の例外処理不備により、状態更新がサイレントに失敗するバグを経験。現在は `try-except` で堅牢化しています（詳細: SUP.1 qa-plan.mdの事例セクション）。

*この調整により、構成管理の透明性が向上し、[REQ-02]の安定稼働に貢献します。*