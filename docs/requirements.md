# 要件定義 (Requirements)

本ドキュメントは、PiPulse Pipelineプロジェクトの要件を定義・管理するためのものです。V字プロセスのSYS.1（要件定義）で作成され、[REQ-01]と[REQ-02]を主要要件としてトレーサビリティを確保します。将来的に追加要件を拡張可能。詳細は **[v-master-guideline.md](v-master-guideline.md)** を参照してください。

**バージョン:** v1.0.7

-----

### 改訂履歴

|日付        |変更者                     |変更内容                                                                                                                  |関連                  |
|----------|------------------------|----------------------------------------------------------------------------------------------------------------------|--------------------|
|2025-10-25|Hideo (assisted by Grok)|[REQ-02]用語/目標明確化: 処理時間<1min（データ取得～アップロード全工程、ネットワーク不安定時超過許容）。冗長避け簡潔化。Grok/Gemini共同評価完了。                                |PR #25<br>(v1.0.7参照)|
|2025-10-25|Hideo (assisted by Grok)|Gemini/Grok共同レビュー反映: REQ-02.1ステータス一部完了に調整、[REQ-02]用語を「準リアルタイム」に修正、REQ-03 Notes補足追加。FR/NFR維持、コミット準備完了。                 |PR #24<br>(v1.0.6参照)|
|2025-10-25|Hideo (assisted by Grok)|Geminiレビュー反映 + Grok追加提案: REQ-01/03役割分担明確化（MySQL挿入をREQ-03へ移行）、REQ-02/02.1月替り処理具体化（アーカイブをREQ-04.2拡張に）。FR/NFR維持、単一責任原則強化。|PR #23<br>(v1.0.5参照)|
|2025-10-25|Hideo (assisted by Grok)|Geminiレビュー反映: REQ-01/03役割分担明確化（MySQL挿入をREQ-03へ移行）、REQ-02/02.1月替り処理具体化（アーカイブ削除、新規ファイル生成に）。FR/NFR維持。                    |PR #22<br>(v1.0.4参照)|
|2025-10-25|Hideo (assisted by Grok)|REQ-02/02.1冗長修正、REQ-04（GitHub Actions自動化）追加。FR/NFR分類維持。                                                               |PR #21<br>(v1.0.3参照)|
|2025-10-25|Hideo (assisted by Grok)|FR/NFRセクション追加、列拡張で要件分類。REQ-02変更反映。                                                                                    |PR #20<br>(v1.0.2参照)|
|2025-10-24|Hideo (assisted by Grok)|初版修正: [REQ-01]間隔を15minに、[REQ-02]をDriveアップロード/月替り処理に特化、[REQ-03]をデータ取り込み/可視化に変更。                                        |PR #19<br>(v1.0.1参照)|

-----

**最終更新:** 2025-10-25

### 用語集

- **[REQ-01]**: センサーデータ収集の基盤化。RPi AHT25センサーからローカルファイルへの定期保存（15min間隔）。
- **[REQ-02]**: 主要横断要件「リアルタイム更新（処理時間<1min目標）」。データ取得～ローカル保存～rcloneアップロードの全工程を対象。ネットワーク不安定時の超過は運用上許容。iPhoneで15min間隔データを確認するためのGoogle Driveアップロード（全履歴2時間毎、月替り処理）。プロジェクト全体に横断。
- **FR (Functional Requirements)**: システムが提供する具体的な機能（何をするか）。
- **NFR (Non-Functional Requirements)**: 性能、セキュリティ、可用性などの品質属性（どうやるか）。
- **7月データ**: テストベースライン（192件、2025-07-28 06:36 ～ 07-30 21:38）。タイムスタンプ形式: `%Y-%m-%d %H:%i`（秒なし）。
- **トレーサビリティ**: 要件IDをSWE/V&V/SUPプロセスにリンクし、変更追跡を確保。

### 機能要件 (FR) / 非機能要件 (NFR) リスト

要件をID、分類（FR/NFR）、説明、優先度、ステータスで管理。派生要件はサブIDで拡張。

|要件ID    |分類 |説明                                                                                                                                             |優先度   |ステータス     |関連成果物                                                                                                                       |Notes                                                                        |
|--------|---|-----------------------------------------------------------------------------------------------------------------------------------------------|------|----------|----------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------|
|REQ-01  |FR |RPi（AHT25センサー）から温度/湿度データを15min間隔で収集し、ローカルファイル（月次・最新）に保存する。エラー時はリトライ（3回）。                                                                       |High  |[x] (完了)  |[hardware-inventory.md](hardware-inventory.md), [software-specs.md](software-specs.md), `20251022_SensorCopier.py`|7月データ192件で検証済み。cronベース。データ収集の基盤。MySQLへの挿入はREQ-03で実施。                         |
|REQ-01.1|NFR|データ形式: timestamp (JST, ISO), temperature (°C), humidity (%RH)。ファイル保存成功率: 99%。                                                                  |Medium|[x] (完了)  |`measurements`テーブルスキーマ（REQ-03参照）                                                                                            |STR_TO_DATE/ DATE_FORMATでインポート対応（REQ-03）。                                    |
|REQ-02  |FR |REQ-01で収集したデータをGoogle Driveにアップロード。全履歴を2時間毎にアップロードし、iPhoneでリアルタイム確認可能に。月替り時には新しい月次ファイルへ自動で切り替える。                                               |High  |[p] (一部完了)|[config-management.md](config-management.md), [implementation.md](implementation.md), rclone設定                    |rclone copy + cronでアップロード。7月データでE2E検証。<1min目標は全処理時間基準（ネットワーク不安定時超過許容）。       |
|REQ-02.1|NFR|Driveアップロード仕様: 最新データは即時、全履歴は2時間毎にバッチ処理。月替り: 新しい月次ファイルを自動生成。iPhone共有リンク対応。遅延: <1min（全処理時間目標）。                                                   |Medium|[p] (一部完了)|[system-design.md](system-design.md)                                                                                   |SYS.3詳細設計でフォーマット記述。月替り処理など一部未実装。アーカイブはREQ-04.2拡張。                            |
|REQ-02.2|NFR|アップロードエラー時Slackアラート（SUP.5）。可用性: 99%成功率。                                                                                                        |Low   |[ ] (未着手) |[qa-plan.md](qa-plan.md)                                                                                               |ログ強化で検知。                                                                     |
|REQ-03  |FR |REQ-02のGoogle DriveデータをMySQL `sensor_data_db.measurements`テーブルに取り込み、MacのPython（pandas/matplotlib）で可視化（折れ線グラフ、時間軸x、温度/湿度y、異常値ハイライト例: temp>40°C）。|Medium|[p] (一部完了)|[software-specs.md](software-specs.md), [system-design.md](system-design.md)                                      |Drive→MySQLインポートスクリプト + Python分析。（現状、iPhoneでの直接的なグラフ表示機能はなく）Macでの可視化を代替手段とする。|
|REQ-03.1|NFR|可視化性能: 192件データで描画<10s。異常値検出精度: 95%以上。セキュリティ: ローカル実行限定。                                                                                         |Medium|[p] (一部完了)|[qa-plan.md](qa-plan.md)                                                                                               |カバレッジ80%テスト。matplotlib使用。                                                    |
|REQ-04  |FR |GitHub ActionsでCI/CDワークフローを自動化（例: pytest実行、PRレビュー、Dependabot更新、RPiデプロイ）。                                                                       |Medium|[ ] (未着手) |[v-master-guideline.md](v-master-guideline.md) (SUP.1/6/7), qa-plan.md                                                 |SUPプロセス連携。Pythonプロジェクトのコード品質/デリバリー加速。                                        |
|REQ-04.1|NFR|ワークフロー実行時間: <1min/ジョブ。成功率: 99%。通知: Slack統合（エラー時）。                                                                                              |Low   |[ ] (未着手) |[qa-plan.md](qa-plan.md)                                                                                               |詳細はSUP.1 ci.ymlで実装。リソース: GitHub無料枠内。                                         |
|REQ-04.2|NFR|アーカイブ機能: 旧月データを圧縮保存（将来的拡張）。可用性: バックアップ復元<5min。                                                                                                 |Low   |[ ] (未着手) |[config-management.md](config-management.md)                                                                           |REQ-02.1月替り拡張。MAN.1リスク対応。                                                    |

*凡例: ステータス [x]=完了, [p]=一部完了, [ ]=未着手*

### トレーサビリティマトリクス

要件とV字プロセスのリンクを簡易マトリクスで追跡。変更時はここを更新。FR/NFRでテスト基準を分離。

|要件ID  |分類|SYS.1 (要件)|SYS.2 (設計)   |SWE.1 (SW要件)|SWE.3 (実装)         |V&V.1 (ユニット)  |SUP.1 (QA)          |Notes                    |
|------|--|----------|-------------|------------|-------------------|--------------|--------------------|-------------------------|
|REQ-01|FR|✓         |✓ (データフロー)   |✓           |✓ (SensorCopier.py)|✓ (pytest)    |✓ (cronテスト)         |基盤要件（ローカル保存）、[REQ-02]前提。 |
|REQ-02|FR|✓         |[p] (同期フロー)  |[p] (派生5件)  |[p] (rclone/月替り)   |[ ] (80%カバレッジ)|[ ] (Actions ci.yml)|横断要件、全フェーズ影響。            |
|REQ-03|FR|✓         |✓ (リスク管理)    |✓           |✓ (インポート/可視化)      |✓             |✓ (CodeQL)          |データ取り込み/可視化横断（MySQL挿入含む）。|
|REQ-04|FR|✓         |[ ] (CI/CD設計)|[ ] (派生)    |[ ] (deploy.yml)   |✓ (自動テスト)     |✓ (Actions統合)       |自動化横断、SUP.1前提。アーカイブ拡張含む。 |

### 次アクション

- Grok/Gemini共同評価: 目標明確化で齟齬解消。追加NFR（スケーラビリティ）検討。
- 拡張: REQ-05「異常値アラート自動化」（Slack + グラフハイライト）を追加検討（V&V.3スケジュールテストリンク）。
- コミット: PR #26でマージ後、v-master-guideline.mdのSYS.1を[x]更新。REQ-02波及修正スタート（High影響箇所から）。
