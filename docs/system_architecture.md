# SYS.2 システムアーキテクチャ設計書
これは V字モデル SYS.2 の正式成果物です。
システム要件を物理的・論理的なコンポーネントに分割し、システム全体の構造を定義したものです。

**最終更新**：2025-12-08（Hideo & Gemini 共同確定）  
**トレース元**：docs/system_requirements.md（全REQ対応）

### 改訂履歴
| 日付         | 変更者               | 変更内容                                           |
|--------------|----------------------|----------------------------------------------------|
| 2025-12-08   | Hideo & Gemini       | 論理アーキテクチャの表を「要件ID」起点に変更し、可読性を向上。 |
| 2025-12-08   | Hideo & Gemini       | 論理アーキテクチャをテーブル形式に刷新し、トレーサビリティと教訓適用状況を統合。 |
| 2025-12-08   | Hideo & Gemini       | 論理アーキテクチャを「教訓駆動」形式に更新。SYS.1のメトリクスとINCを設計に紐付け。 |
| 2025-12-07   | Hideo & Gemini       | Mermaid図をリスト形式に変更し、可読性を向上。セクション番号の重複を修正。 |
| 2025-12-06   | Hideo, Grok, Gemini  | 用語集を追加し、ドキュメント全体の書式を最終FIX。    |
| 2025-12-06   | Hideo, Grok, Gemini  | 全ドキュメントと整合性を取るFIX。ハードウェア名を`RPi 4`に統一。 |
| 2025-12-06   | Hideo, Grok, Gemini  | 旧system-design.mdをSYS.2正式成果物に昇格。        |

### 用語集（本ドキュメント固有）
- **システムコンテキスト**: システムとその外部環境（ユーザー、他システム等）との境界と相互作用の定義。
- **論理アーキテクチャ**: システムを構成する主要な論理コンポーネント（機能部品）と、それらの間のデータフローや連携の定義。

### 1. システムコンテキスト
システム全体と、それを取り巻く外部要素との関係性を示します。

- **`AHT25 センサー`**: `Raspberry Pi 4` がI2C経由でデータを読み取る物理デバイス。
- **`Raspberry Pi 4`**: センサーデータを収集・処理し、`Google Drive`へアップロードする中核コンポーネント。
- **`Google Drive`**: `Raspberry Pi 4` からのデータを受け取るクラウドストレージ。
- **`MySQL`**: `Google Drive` のデータを格納し、分析の基盤となるデータベース。
- **`Mac 可視化スクリプト`**: `MySQL` のデータを読み取り、グラフとして可視化する。
- **`Slack`**: (将来拡張) `Raspberry Pi 4` からの通知を受け取る。

### 2. 論理アーキテクチャ
各要件を達成するために、`Raspberry Pi 4`上でどの論理コンポーネントがどう設計され、どの教訓が適用されているかを示します。

| 要件ID | 論理コンポーネント | 設計概要 | 達成メトリクス | 適用した教訓 |
|---|---|---|---|---|
| REQ-01 | `cron` スケジューラ | `SensorCopier.py` を15分間隔で起動する。 | ・時刻誤差 | - |
| | AHT25センサー読み取り | I2C経由でデータを読み取り、エラー時はリトライ処理を行う。 | ・欠測数 | - |
| REQ-01 | `cron` スケジューラ<br>AHT25センサー読み取り | 15分間隔でI2C経由でデータを読み取り、エラー時はリトライする。 | ・時刻誤差<br>・欠測数 | - |
| REQ-01.1 | 柔軟なタイムスタンプパース | 秒の有無を自動判別してパースする専用関数を設ける。 | ・パース成功率 | **INC-005**: データ形式混在によるパース失敗を防止。 |
| REQ-02 | `rclone copy` 同期 | 最新ファイルを即時アップロードし、2時間ごとに全体同期する。 | ・E2E処理時間 | **INC-001**: `sync`→`copy`変更でデータ損失を排除。 |
| REQ-02.1 | ファイル書き込み | 月次ファイル（追記）と最新ファイル（上書き）に分離し、JSTで統一する。 | ・月替りファイル生成時刻 | **INC-002**: タイムゾーンをJSTに統一し移行ミスを防止。 |
| REQ-02.2 | Slackアラート (将来拡張) | アップロード失敗時にSlackへ通知を送信する。 | ・通知遅延 | - |
| REQ-03 | MySQLインポート<br>Mac可視化スクリプト | DriveデータをMySQLに取り込み、Macでグラフ可視化する。 | ・描画時間<br>・異常値の可視性 | - |
| REQ-03.1 | Mac可視化スクリプト | 異常値（例: temp>40℃）を検出し、グラフ上で強調表示する。 | ・描画時間<br>・異常値検出精度 | - |
| REQ-04 | GitHub Actions CI/CD | mainブランチへのプッシュをトリガーに、テストとデプロイを自動化する。 | ・デプロイ時間 | - |
| REQ-04.1 | アーカイブ機構 (将来拡張) | 旧月次データを自動で圧縮し、ストレージを節約する。 | ・アーカイブ生成時間<br>・復元正確性 | - |